//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/Salton/Documents/Projects/xstream/xstream/src/java/com/thoughtworks/xstream/core/util/QuickWriter.java
//

#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "com/thoughtworks/xstream/core/util/QuickWriter.h"
#include "com/thoughtworks/xstream/io/StreamException.h"
#include "java/io/IOException.h"
#include "java/io/Writer.h"
#include "java/lang/System.h"

@interface ComThoughtworksXstreamCoreUtilQuickWriter () {
 @public
  JavaIoWriter *writer_;
  IOSCharArray *buffer_;
  jint pointer_;
}

- (void)rawWithCharArray:(IOSCharArray *)c;

- (void)rawWithChar:(jchar)c;

@end

J2OBJC_FIELD_SETTER(ComThoughtworksXstreamCoreUtilQuickWriter, writer_, JavaIoWriter *)
J2OBJC_FIELD_SETTER(ComThoughtworksXstreamCoreUtilQuickWriter, buffer_, IOSCharArray *)

__attribute__((unused)) static void ComThoughtworksXstreamCoreUtilQuickWriter_rawWithCharArray_(ComThoughtworksXstreamCoreUtilQuickWriter *self, IOSCharArray *c);

__attribute__((unused)) static void ComThoughtworksXstreamCoreUtilQuickWriter_rawWithChar_(ComThoughtworksXstreamCoreUtilQuickWriter *self, jchar c);

@implementation ComThoughtworksXstreamCoreUtilQuickWriter

- (instancetype __nonnull)initWithJavaIoWriter:(JavaIoWriter *)writer {
  ComThoughtworksXstreamCoreUtilQuickWriter_initWithJavaIoWriter_(self, writer);
  return self;
}

- (instancetype __nonnull)initWithJavaIoWriter:(JavaIoWriter *)writer
                                       withInt:(jint)bufferSize {
  ComThoughtworksXstreamCoreUtilQuickWriter_initWithJavaIoWriter_withInt_(self, writer, bufferSize);
  return self;
}

- (void)writeWithNSString:(NSString *)str {
  jint len = [((NSString *) nil_chk(str)) java_length];
  if (pointer_ + len >= ((IOSCharArray *) nil_chk(buffer_))->size_) {
    [self flush];
    if (len > ((IOSCharArray *) nil_chk(buffer_))->size_) {
      ComThoughtworksXstreamCoreUtilQuickWriter_rawWithCharArray_(self, [str java_toCharArray]);
      return;
    }
  }
  [str java_getChars:0 sourceEnd:len destination:buffer_ destinationBegin:pointer_];
  pointer_ += len;
}

- (void)writeWithChar:(jchar)c {
  if (pointer_ + 1 >= ((IOSCharArray *) nil_chk(buffer_))->size_) {
    [self flush];
    if (((IOSCharArray *) nil_chk(buffer_))->size_ == 0) {
      ComThoughtworksXstreamCoreUtilQuickWriter_rawWithChar_(self, c);
      return;
    }
  }
  *IOSCharArray_GetRef(buffer_, pointer_++) = c;
}

- (void)writeWithCharArray:(IOSCharArray *)c {
  jint len = ((IOSCharArray *) nil_chk(c))->size_;
  if (pointer_ + len >= ((IOSCharArray *) nil_chk(buffer_))->size_) {
    [self flush];
    if (len > ((IOSCharArray *) nil_chk(buffer_))->size_) {
      ComThoughtworksXstreamCoreUtilQuickWriter_rawWithCharArray_(self, c);
      return;
    }
  }
  JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(c, 0, buffer_, pointer_, len);
  pointer_ += len;
}

- (void)flush {
  @try {
    [((JavaIoWriter *) nil_chk(writer_)) writeWithCharArray:buffer_ withInt:0 withInt:pointer_];
    pointer_ = 0;
    [writer_ flush];
  }
  @catch (JavaIoIOException *e) {
    @throw create_ComThoughtworksXstreamIoStreamException_initWithJavaLangThrowable_(e);
  }
}

- (void)close {
  @try {
    [((JavaIoWriter *) nil_chk(writer_)) writeWithCharArray:buffer_ withInt:0 withInt:pointer_];
    pointer_ = 0;
    [writer_ close];
  }
  @catch (JavaIoIOException *e) {
    @throw create_ComThoughtworksXstreamIoStreamException_initWithJavaLangThrowable_(e);
  }
}

- (void)rawWithCharArray:(IOSCharArray *)c {
  ComThoughtworksXstreamCoreUtilQuickWriter_rawWithCharArray_(self, c);
}

- (void)rawWithChar:(jchar)c {
  ComThoughtworksXstreamCoreUtilQuickWriter_rawWithChar_(self, c);
}

- (void)dealloc {
  RELEASE_(writer_);
  RELEASE_(buffer_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 2, 3, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 2, 4, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 2, 5, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 6, 5, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 6, 4, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithJavaIoWriter:);
  methods[1].selector = @selector(initWithJavaIoWriter:withInt:);
  methods[2].selector = @selector(writeWithNSString:);
  methods[3].selector = @selector(writeWithChar:);
  methods[4].selector = @selector(writeWithCharArray:);
  methods[5].selector = @selector(flush);
  methods[6].selector = @selector(close);
  methods[7].selector = @selector(rawWithCharArray:);
  methods[8].selector = @selector(rawWithChar:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "writer_", "LJavaIoWriter;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "buffer_", "[C", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "pointer_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LJavaIoWriter;", "LJavaIoWriter;I", "write", "LNSString;", "C", "[C", "raw" };
  static const J2ObjcClassInfo _ComThoughtworksXstreamCoreUtilQuickWriter = { "QuickWriter", "com.thoughtworks.xstream.core.util", ptrTable, methods, fields, 7, 0x1, 9, 3, -1, -1, -1, -1, -1 };
  return &_ComThoughtworksXstreamCoreUtilQuickWriter;
}

@end

void ComThoughtworksXstreamCoreUtilQuickWriter_initWithJavaIoWriter_(ComThoughtworksXstreamCoreUtilQuickWriter *self, JavaIoWriter *writer) {
  ComThoughtworksXstreamCoreUtilQuickWriter_initWithJavaIoWriter_withInt_(self, writer, 1024);
}

ComThoughtworksXstreamCoreUtilQuickWriter *new_ComThoughtworksXstreamCoreUtilQuickWriter_initWithJavaIoWriter_(JavaIoWriter *writer) {
  J2OBJC_NEW_IMPL(ComThoughtworksXstreamCoreUtilQuickWriter, initWithJavaIoWriter_, writer)
}

ComThoughtworksXstreamCoreUtilQuickWriter *create_ComThoughtworksXstreamCoreUtilQuickWriter_initWithJavaIoWriter_(JavaIoWriter *writer) {
  J2OBJC_CREATE_IMPL(ComThoughtworksXstreamCoreUtilQuickWriter, initWithJavaIoWriter_, writer)
}

void ComThoughtworksXstreamCoreUtilQuickWriter_initWithJavaIoWriter_withInt_(ComThoughtworksXstreamCoreUtilQuickWriter *self, JavaIoWriter *writer, jint bufferSize) {
  NSObject_init(self);
  JreStrongAssign(&self->writer_, writer);
  JreStrongAssignAndConsume(&self->buffer_, [IOSCharArray newArrayWithLength:bufferSize]);
}

ComThoughtworksXstreamCoreUtilQuickWriter *new_ComThoughtworksXstreamCoreUtilQuickWriter_initWithJavaIoWriter_withInt_(JavaIoWriter *writer, jint bufferSize) {
  J2OBJC_NEW_IMPL(ComThoughtworksXstreamCoreUtilQuickWriter, initWithJavaIoWriter_withInt_, writer, bufferSize)
}

ComThoughtworksXstreamCoreUtilQuickWriter *create_ComThoughtworksXstreamCoreUtilQuickWriter_initWithJavaIoWriter_withInt_(JavaIoWriter *writer, jint bufferSize) {
  J2OBJC_CREATE_IMPL(ComThoughtworksXstreamCoreUtilQuickWriter, initWithJavaIoWriter_withInt_, writer, bufferSize)
}

void ComThoughtworksXstreamCoreUtilQuickWriter_rawWithCharArray_(ComThoughtworksXstreamCoreUtilQuickWriter *self, IOSCharArray *c) {
  @try {
    [((JavaIoWriter *) nil_chk(self->writer_)) writeWithCharArray:c];
    [self->writer_ flush];
  }
  @catch (JavaIoIOException *e) {
    @throw create_ComThoughtworksXstreamIoStreamException_initWithJavaLangThrowable_(e);
  }
}

void ComThoughtworksXstreamCoreUtilQuickWriter_rawWithChar_(ComThoughtworksXstreamCoreUtilQuickWriter *self, jchar c) {
  @try {
    [((JavaIoWriter *) nil_chk(self->writer_)) writeWithInt:c];
    [self->writer_ flush];
  }
  @catch (JavaIoIOException *e) {
    @throw create_ComThoughtworksXstreamIoStreamException_initWithJavaLangThrowable_(e);
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComThoughtworksXstreamCoreUtilQuickWriter)
