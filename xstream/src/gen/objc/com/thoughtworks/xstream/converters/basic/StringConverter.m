//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/Salton/Documents/Projects/xstream/xstream/src/java/com/thoughtworks/xstream/converters/basic/StringConverter.java
//

#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "com/thoughtworks/xstream/converters/basic/AbstractSingleValueConverter.h"
#include "com/thoughtworks/xstream/converters/basic/StringConverter.h"
#include "com/thoughtworks/xstream/core/util/WeakCache.h"
#include "java/util/Collections.h"
#include "java/util/Map.h"

@interface ComThoughtworksXstreamConvertersBasicStringConverter () {
 @public
  /*!
   @brief A Map to store strings as long as needed to map similar strings onto the same instance
  and conserve memory.The map can be set from the outside during construction, so it can
  be a LRU map or a weak map, synchronised or not.
   */
  id<JavaUtilMap> cache_;
  jint lengthLimit_;
}

@end

J2OBJC_FIELD_SETTER(ComThoughtworksXstreamConvertersBasicStringConverter, cache_, id<JavaUtilMap>)

inline jint ComThoughtworksXstreamConvertersBasicStringConverter_get_LENGTH_LIMIT(void);
#define ComThoughtworksXstreamConvertersBasicStringConverter_LENGTH_LIMIT 38
J2OBJC_STATIC_FIELD_CONSTANT(ComThoughtworksXstreamConvertersBasicStringConverter, LENGTH_LIMIT, jint)

@implementation ComThoughtworksXstreamConvertersBasicStringConverter

- (instancetype __nonnull)initWithJavaUtilMap:(id<JavaUtilMap>)map
                                      withInt:(jint)lengthLimit {
  ComThoughtworksXstreamConvertersBasicStringConverter_initWithJavaUtilMap_withInt_(self, map, lengthLimit);
  return self;
}

- (instancetype __nonnull)initWithJavaUtilMap:(id<JavaUtilMap>)map {
  ComThoughtworksXstreamConvertersBasicStringConverter_initWithJavaUtilMap_(self, map);
  return self;
}

- (instancetype __nonnull)initWithInt:(jint)lengthLimit {
  ComThoughtworksXstreamConvertersBasicStringConverter_initWithInt_(self, lengthLimit);
  return self;
}

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype __nonnull)init {
  ComThoughtworksXstreamConvertersBasicStringConverter_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (jboolean)canConvertWithIOSClass:(IOSClass *)type {
  return [((IOSClass *) nil_chk(type)) isEqual:NSString_class_()];
}

- (id)fromStringWithNSString:(NSString *)str {
  if (cache_ != nil && str != nil && (lengthLimit_ < 0 || [str java_length] <= lengthLimit_)) {
    NSString *s = (NSString *) cast_chk([cache_ getWithId:str], [NSString class]);
    if (s == nil) {
      [cache_ putWithId:str withId:str];
      s = str;
    }
    return s;
  }
  else {
    return str;
  }
}

- (void)dealloc {
  RELEASE_(cache_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 1, -1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 2, -1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, 3, 4, -1, -1, -1, -1 },
    { NULL, "LNSObject;", 0x1, 5, 6, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithJavaUtilMap:withInt:);
  methods[1].selector = @selector(initWithJavaUtilMap:);
  methods[2].selector = @selector(initWithInt:);
  methods[3].selector = @selector(init);
  methods[4].selector = @selector(canConvertWithIOSClass:);
  methods[5].selector = @selector(fromStringWithNSString:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "LENGTH_LIMIT", "I", .constantValue.asInt = ComThoughtworksXstreamConvertersBasicStringConverter_LENGTH_LIMIT, 0x1a, -1, -1, -1, -1 },
    { "cache_", "LJavaUtilMap;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "lengthLimit_", "I", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LJavaUtilMap;I", "LJavaUtilMap;", "I", "canConvert", "LIOSClass;", "fromString", "LNSString;" };
  static const J2ObjcClassInfo _ComThoughtworksXstreamConvertersBasicStringConverter = { "StringConverter", "com.thoughtworks.xstream.converters.basic", ptrTable, methods, fields, 7, 0x1, 6, 3, -1, -1, -1, -1, -1 };
  return &_ComThoughtworksXstreamConvertersBasicStringConverter;
}

@end

void ComThoughtworksXstreamConvertersBasicStringConverter_initWithJavaUtilMap_withInt_(ComThoughtworksXstreamConvertersBasicStringConverter *self, id<JavaUtilMap> map, jint lengthLimit) {
  ComThoughtworksXstreamConvertersBasicAbstractSingleValueConverter_init(self);
  JreStrongAssign(&self->cache_, map);
  self->lengthLimit_ = lengthLimit;
}

ComThoughtworksXstreamConvertersBasicStringConverter *new_ComThoughtworksXstreamConvertersBasicStringConverter_initWithJavaUtilMap_withInt_(id<JavaUtilMap> map, jint lengthLimit) {
  J2OBJC_NEW_IMPL(ComThoughtworksXstreamConvertersBasicStringConverter, initWithJavaUtilMap_withInt_, map, lengthLimit)
}

ComThoughtworksXstreamConvertersBasicStringConverter *create_ComThoughtworksXstreamConvertersBasicStringConverter_initWithJavaUtilMap_withInt_(id<JavaUtilMap> map, jint lengthLimit) {
  J2OBJC_CREATE_IMPL(ComThoughtworksXstreamConvertersBasicStringConverter, initWithJavaUtilMap_withInt_, map, lengthLimit)
}

void ComThoughtworksXstreamConvertersBasicStringConverter_initWithJavaUtilMap_(ComThoughtworksXstreamConvertersBasicStringConverter *self, id<JavaUtilMap> map) {
  ComThoughtworksXstreamConvertersBasicStringConverter_initWithJavaUtilMap_withInt_(self, map, ComThoughtworksXstreamConvertersBasicStringConverter_LENGTH_LIMIT);
}

ComThoughtworksXstreamConvertersBasicStringConverter *new_ComThoughtworksXstreamConvertersBasicStringConverter_initWithJavaUtilMap_(id<JavaUtilMap> map) {
  J2OBJC_NEW_IMPL(ComThoughtworksXstreamConvertersBasicStringConverter, initWithJavaUtilMap_, map)
}

ComThoughtworksXstreamConvertersBasicStringConverter *create_ComThoughtworksXstreamConvertersBasicStringConverter_initWithJavaUtilMap_(id<JavaUtilMap> map) {
  J2OBJC_CREATE_IMPL(ComThoughtworksXstreamConvertersBasicStringConverter, initWithJavaUtilMap_, map)
}

void ComThoughtworksXstreamConvertersBasicStringConverter_initWithInt_(ComThoughtworksXstreamConvertersBasicStringConverter *self, jint lengthLimit) {
  ComThoughtworksXstreamConvertersBasicStringConverter_initWithJavaUtilMap_withInt_(self, JavaUtilCollections_synchronizedMapWithJavaUtilMap_(create_ComThoughtworksXstreamCoreUtilWeakCache_init()), lengthLimit);
}

ComThoughtworksXstreamConvertersBasicStringConverter *new_ComThoughtworksXstreamConvertersBasicStringConverter_initWithInt_(jint lengthLimit) {
  J2OBJC_NEW_IMPL(ComThoughtworksXstreamConvertersBasicStringConverter, initWithInt_, lengthLimit)
}

ComThoughtworksXstreamConvertersBasicStringConverter *create_ComThoughtworksXstreamConvertersBasicStringConverter_initWithInt_(jint lengthLimit) {
  J2OBJC_CREATE_IMPL(ComThoughtworksXstreamConvertersBasicStringConverter, initWithInt_, lengthLimit)
}

void ComThoughtworksXstreamConvertersBasicStringConverter_init(ComThoughtworksXstreamConvertersBasicStringConverter *self) {
  ComThoughtworksXstreamConvertersBasicStringConverter_initWithInt_(self, ComThoughtworksXstreamConvertersBasicStringConverter_LENGTH_LIMIT);
}

ComThoughtworksXstreamConvertersBasicStringConverter *new_ComThoughtworksXstreamConvertersBasicStringConverter_init() {
  J2OBJC_NEW_IMPL(ComThoughtworksXstreamConvertersBasicStringConverter, init)
}

ComThoughtworksXstreamConvertersBasicStringConverter *create_ComThoughtworksXstreamConvertersBasicStringConverter_init() {
  J2OBJC_CREATE_IMPL(ComThoughtworksXstreamConvertersBasicStringConverter, init)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComThoughtworksXstreamConvertersBasicStringConverter)
